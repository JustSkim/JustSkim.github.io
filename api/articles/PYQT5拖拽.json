{"title":"PYQT5拖拽","slug":"PYQT5拖拽","date":"2021-08-30T21:31:39.560Z","updated":"2021-08-30T21:31:57.703Z","comments":true,"path":"api/articles/PYQT5拖拽.json","photos":[],"link":"","excerpt":null,"covers":null,"content":"<h1 id=\"PYQT5拖拽\"><a href=\"#PYQT5拖拽\" class=\"headerlink\" title=\"PYQT5拖拽\"></a>PYQT5拖拽</h1><h2 id=\"简单的拖放\"><a href=\"#简单的拖放\" class=\"headerlink\" title=\"简单的拖放\"></a>简单的拖放</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/python3</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">例子：拖放</span></span><br><span class=\"line\"><span class=\"string\">ZetCode PyQt5 tutorial</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">This is a simple drag and</span></span><br><span class=\"line\"><span class=\"string\">drop example. </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Author: Jan Bodnar</span></span><br><span class=\"line\"><span class=\"string\">Website: zetcode.com</span></span><br><span class=\"line\"><span class=\"string\">Last edited: August 2017</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> PyQt5.QtWidgets <span class=\"keyword\">import</span> (QPushButton, QWidget, </span><br><span class=\"line\">    QLineEdit, QApplication)</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Button</span>(<span class=\"params\">QPushButton</span>):</span></span><br><span class=\"line\">    <span class=\"comment\">#用QPushButton上构造一个按钮实例</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, title, parent</span>):</span></span><br><span class=\"line\">        <span class=\"built_in\">super</span>().__init__(title, parent)</span><br><span class=\"line\"></span><br><span class=\"line\">        self.setAcceptDrops(<span class=\"literal\">True</span>)</span><br><span class=\"line\">        <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">        激活组件的拖拽事件</span></span><br><span class=\"line\"><span class=\"string\">        &#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">dragEnterEvent</span>(<span class=\"params\">self, e</span>):</span></span><br><span class=\"line\">        <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">        重构了dragEnterEvent()方法。设定好接受拖拽的数据类型（plain text）</span></span><br><span class=\"line\"><span class=\"string\">        &#x27;&#x27;&#x27;</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> e.mimeData().hasFormat(<span class=\"string\">&#x27;text/plain&#x27;</span>):</span><br><span class=\"line\">            e.accept()</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            e.ignore() </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">dropEvent</span>(<span class=\"params\">self, e</span>):</span></span><br><span class=\"line\">        <span class=\"comment\">#重构dropEvent()方法，更改按钮接受鼠标的释放事件的默认行为。</span></span><br><span class=\"line\">        self.setText(e.mimeData().text()) </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Example</span>(<span class=\"params\">QWidget</span>):</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"built_in\">super</span>().__init__()</span><br><span class=\"line\"></span><br><span class=\"line\">        self.initUI()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initUI</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\"></span><br><span class=\"line\">        edit = QLineEdit(<span class=\"string\">&#x27;line-edit&#x27;</span>, self)</span><br><span class=\"line\">        <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">        QLineEdit默认支持拖拽操作，所以我们只要调用setDragEnabled()方法使用就行了。</span></span><br><span class=\"line\"><span class=\"string\">        &#x27;&#x27;&#x27;</span></span><br><span class=\"line\">        edit.setDragEnabled(<span class=\"literal\">True</span>)</span><br><span class=\"line\">        edit.move(<span class=\"number\">30</span>, <span class=\"number\">65</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        button = Button(<span class=\"string\">&quot;Button&quot;</span>, self)</span><br><span class=\"line\">        button.move(<span class=\"number\">190</span>, <span class=\"number\">65</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        self.setWindowTitle(<span class=\"string\">&#x27;Simple drag and drop&#x27;</span>)</span><br><span class=\"line\">        self.setGeometry(<span class=\"number\">300</span>, <span class=\"number\">300</span>, <span class=\"number\">300</span>, <span class=\"number\">150</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\"></span><br><span class=\"line\">    app = QApplication(sys.argv)</span><br><span class=\"line\">    ex = Example()</span><br><span class=\"line\">    ex.show()</span><br><span class=\"line\">    app.exec_()</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"拖放按钮组件\"><a href=\"#拖放按钮组件\" class=\"headerlink\" title=\"拖放按钮组件\"></a>拖放按钮组件</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/python3</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">例子：拖放按钮组件  注意是右键拖拽！！！</span></span><br><span class=\"line\"><span class=\"string\">ZetCode PyQt5 tutorial</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">In this program, we can press on a button with a left mouse</span></span><br><span class=\"line\"><span class=\"string\">click or drag and drop the button with  the right mouse click. </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Author: Jan Bodnar</span></span><br><span class=\"line\"><span class=\"string\">Website: zetcode.com</span></span><br><span class=\"line\"><span class=\"string\">Last edited: August 2017</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">例子中，窗口上有一个QPushButton组件。</span></span><br><span class=\"line\"><span class=\"string\">左键点击按钮，控制台就会输出press。右键可以点击然后拖动按钮。</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> PyQt5.QtWidgets <span class=\"keyword\">import</span> QPushButton, QWidget, QApplication</span><br><span class=\"line\"><span class=\"keyword\">from</span> PyQt5.QtCore <span class=\"keyword\">import</span> Qt, QMimeData</span><br><span class=\"line\"><span class=\"keyword\">from</span> PyQt5.QtGui <span class=\"keyword\">import</span> QDrag</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Button</span>(<span class=\"params\">QPushButton</span>):</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self, title, parent</span>):</span></span><br><span class=\"line\">        <span class=\"built_in\">super</span>().__init__(title, parent)</span><br><span class=\"line\">    <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">    从QPushButton继承一个Button类，然后重构QPushButton的两个方法: mouseMoveEvent()和mousePressEvent().</span></span><br><span class=\"line\"><span class=\"string\">    mouseMoveEvent()是拖拽开始的事件。</span></span><br><span class=\"line\"><span class=\"string\">    mousePressEvent()是鼠标给予压力的事件，分鼠标左键、右键、滚轮、前进键、后退键（不包含dpi键）</span></span><br><span class=\"line\"><span class=\"string\">    &#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">mouseMoveEvent</span>(<span class=\"params\">self, e</span>):</span></span><br><span class=\"line\">        <span class=\"comment\">#这里只劫持按钮的右键事件（Qt.RightButton），左键的操作还是默认行为</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> e.buttons() != Qt.RightButton:</span><br><span class=\"line\">            <span class=\"keyword\">return</span></span><br><span class=\"line\"></span><br><span class=\"line\">        mimeData = QMimeData()</span><br><span class=\"line\"></span><br><span class=\"line\">        drag = QDrag(self)</span><br><span class=\"line\">        <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">        创建一个QDrag对象，用来传输MIME-based数据。</span></span><br><span class=\"line\"><span class=\"string\">        &#x27;&#x27;&#x27;</span></span><br><span class=\"line\">        drag.setMimeData(mimeData)</span><br><span class=\"line\">        drag.setHotSpot(e.pos() - self.rect().topLeft())</span><br><span class=\"line\"></span><br><span class=\"line\">        dropAction = drag.exec_(Qt.MoveAction)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">mousePressEvent</span>(<span class=\"params\">self, e</span>):</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">super</span>().mousePressEvent(e)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> e.button() == Qt.LeftButton:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;press&#x27;</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">print</span>(e.button())</span><br><span class=\"line\">        <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">        左键点击按钮，会在控制台输出“press”。注意，我们在父级上也调用了mousePressEvent()方法，</span></span><br><span class=\"line\"><span class=\"string\">        不然的话，我们是看不到按钮按下的效果的。</span></span><br><span class=\"line\"><span class=\"string\">        mousePressEvent()是鼠标给予压力的事件，各个键有对应的int值（e.button()）</span></span><br><span class=\"line\"><span class=\"string\">        分鼠标左键（Qt.leftButton = 1）、右键（2）、滚轮（4）、前进键（16）、后退键（8） （不包含dpi键）</span></span><br><span class=\"line\"><span class=\"string\">        &#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Example</span>(<span class=\"params\">QWidget</span>):</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\">        <span class=\"built_in\">super</span>().__init__()</span><br><span class=\"line\"></span><br><span class=\"line\">        self.initUI()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initUI</span>(<span class=\"params\">self</span>):</span></span><br><span class=\"line\"></span><br><span class=\"line\">        self.setAcceptDrops(<span class=\"literal\">True</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        self.button = Button(<span class=\"string\">&#x27;Button&#x27;</span>, self)</span><br><span class=\"line\">        self.button.move(<span class=\"number\">100</span>, <span class=\"number\">65</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        self.setWindowTitle(<span class=\"string\">&#x27;Click or Move&#x27;</span>)</span><br><span class=\"line\">        self.setGeometry(<span class=\"number\">300</span>, <span class=\"number\">300</span>, <span class=\"number\">280</span>, <span class=\"number\">150</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">dragEnterEvent</span>(<span class=\"params\">self, e</span>):</span></span><br><span class=\"line\"></span><br><span class=\"line\">        e.accept()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">dropEvent</span>(<span class=\"params\">self, e</span>):</span></span><br><span class=\"line\"></span><br><span class=\"line\">        position = e.pos()</span><br><span class=\"line\">        self.button.move(position)</span><br><span class=\"line\">        <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">        在dropEvent()方法里，我们定义了按钮按下后和释放后的行为，获得鼠标移动的位置，然后把按钮放到这个地方</span></span><br><span class=\"line\"><span class=\"string\">        &#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        e.setDropAction(Qt.MoveAction)</span><br><span class=\"line\">        <span class=\"string\">&#x27;&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"string\">        指定放下的动作类型为moveAction</span></span><br><span class=\"line\"><span class=\"string\">        &#x27;&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\"></span><br><span class=\"line\">    app = QApplication(sys.argv)</span><br><span class=\"line\">    ex = Example()</span><br><span class=\"line\">    ex.show()</span><br><span class=\"line\">    app.exec_()</span><br></pre></td></tr></table></figure>\n\n","categories":[{"name":"Programming languages and projects","slug":"Programming-languages-and-projects","count":13,"path":"api/categories/Programming-languages-and-projects.json"},{"name":"Python3","slug":"Programming-languages-and-projects/Python3","count":9,"path":"api/categories/Programming-languages-and-projects/Python3.json"},{"name":"PYQT5","slug":"Programming-languages-and-projects/Python3/PYQT5","count":9,"path":"api/categories/Programming-languages-and-projects/Python3/PYQT5.json"}],"tags":[{"name":"python3","slug":"python3","count":9,"path":"api/tags/python3.json"},{"name":"gui","slug":"gui","count":9,"path":"api/tags/gui.json"}]}